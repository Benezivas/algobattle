
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Algobattle framework, an interactive, easy to use computer science lab course">
      
      
      
      
        <link rel="prev" href="../problem_file/">
      
      
        <link rel="next" href="../advanced/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.3">
    
    
      
        <title>A Complex Example - Algobattle</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.50c56a3b.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7Cmonospace:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"monospace"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../../css/termynal.css">
    
      <link rel="stylesheet" href="../../../css/custom.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="amber">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#a-complex-example" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Algobattle" class="md-header__button md-logo" aria-label="Algobattle" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Algobattle
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              A Complex Example
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="amber"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="amber"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/Benezivas/algobattle" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    benezivas/algobattle
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../tutorial/" class="md-tabs__link">
          
  
    
  
  Tutorial

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../advanced/" class="md-tabs__link">
          
  
    
  
  Advanced Topics

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../" class="md-tabs__link">
          
  
    
  
  Instructor's Corner

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../api/" class="md-tabs__link">
          
  
    
  
  API Reference

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Algobattle" class="md-nav__button md-logo" aria-label="Algobattle" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Algobattle
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Benezivas/algobattle" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    benezivas/algobattle
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../tutorial/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Tutorial
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Tutorial
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tutorial/installation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installing Algobattle
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tutorial/getting_started/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Getting Started
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tutorial/programs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Writing programs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tutorial/match/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Running a match
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tutorial/summary/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Conclusion
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../advanced/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Advanced Topics
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Advanced Topics
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../advanced/config/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Settings
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../advanced/battle_types/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Battle Types
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../advanced/docker/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Docker
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../advanced/problems/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Problems
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Instructor's Corner
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Instructor's Corner
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../teaching_english/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lab Course Teaching Concept
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" checked>
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Creating Problems
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            Creating Problems
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../problem_file/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Creating a Problem File
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    A Complex Example
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    A Complex Example
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#the-2d-knapsack-problem" class="md-nav__link">
    <span class="md-ellipsis">
      The 2D Knapsack Problem
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#starting-off" class="md-nav__link">
    <span class="md-ellipsis">
      Starting Off
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#writing-a-mock-generator-and-solver" class="md-nav__link">
    <span class="md-ellipsis">
      Writing a Mock Generator and Solver
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#handling-instances" class="md-nav__link">
    <span class="md-ellipsis">
      Handling Instances
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#handling-solutions" class="md-nav__link">
    <span class="md-ellipsis">
      Handling Solutions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#best-practice-writing-tests" class="md-nav__link">
    <span class="md-ellipsis">
      Best Practice: Writing Tests
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#writing-a-description" class="md-nav__link">
    <span class="md-ellipsis">
      Writing a Description
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#packaging-everything-together" class="md-nav__link">
    <span class="md-ellipsis">
      Packaging Everything Together
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-completed-problempy-file" class="md-nav__link">
    <span class="md-ellipsis">
      The Completed problem.py File
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../advanced/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Advanced Features
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../annotations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Advanced Type Annotations
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../io/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Arbitrary I/O Formats
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../api/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    API Reference
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5" id="__nav_5_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/battle/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Battle
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/problem/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Problem
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/util/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Utility
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#the-2d-knapsack-problem" class="md-nav__link">
    <span class="md-ellipsis">
      The 2D Knapsack Problem
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#starting-off" class="md-nav__link">
    <span class="md-ellipsis">
      Starting Off
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#writing-a-mock-generator-and-solver" class="md-nav__link">
    <span class="md-ellipsis">
      Writing a Mock Generator and Solver
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#handling-instances" class="md-nav__link">
    <span class="md-ellipsis">
      Handling Instances
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#handling-solutions" class="md-nav__link">
    <span class="md-ellipsis">
      Handling Solutions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#best-practice-writing-tests" class="md-nav__link">
    <span class="md-ellipsis">
      Best Practice: Writing Tests
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#writing-a-description" class="md-nav__link">
    <span class="md-ellipsis">
      Writing a Description
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#packaging-everything-together" class="md-nav__link">
    <span class="md-ellipsis">
      Packaging Everything Together
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-completed-problempy-file" class="md-nav__link">
    <span class="md-ellipsis">
      The Completed problem.py File
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="a-complex-example">A Complex Example<a class="headerlink" href="#a-complex-example" title="Permanent link">&para;</a></h1>
<h2 id="the-2d-knapsack-problem">The 2D Knapsack Problem<a class="headerlink" href="#the-2d-knapsack-problem" title="Permanent link">&para;</a></h2>
<p>In this section, we implement the so called 2D Knapsack Problem in its entirety,
starting from scratch and ending with a packaged problem archive that
can be handed out to others.</p>
<div class="admonition abstract">
<p class="admonition-title">Usage of Complex Features</p>
<p>In parts of this we will use rather advanced features of Algobattle. We recommend looking up the more detailed
explanations of anything you're unsure about in its corresponding section.</p>
</div>
<p>To start, let us define the problem. We are given a two-dimensional, rectangular
space with an integer length and width, each of size at least one. We now
want to pack a number of smaller rectangles into this space, such that no two 
pieces overlap and such that as much space is covered as possible. Each
piece may be rotated by 90 degrees.</p>
<p>An instance for this problem thus consists of the dimensions of the knapsack as
well as a limited set of rectangular items. A solution for this problem then
describes where which piece should be placed and if it should be rotated by 90
degrees before being placed. The size of the solution is then the total area
covered.</p>
<h2 id="starting-off">Starting Off<a class="headerlink" href="#starting-off" title="Permanent link">&para;</a></h2>
<p>As in the previous section, we use the <code>algobattle</code> cli to construct a dummy
problem folder for us. Since we are interested in later writing a dummy
generator and dummy solver in python, we let the cli generate a stub of them
for us as well as follows:</p>
<div class="highlight"><pre><span></span><code><span class="go">~ algobattle init --new -p &quot;2D Knapsack&quot; -l python</span>
<span class="go">Created a new problem file at 2D Knapsack/problem.py</span>
<span class="go">Created a python generator in 2D Knapsack/generator</span>
<span class="go">Created a python solver in 2D Knapsack/solver</span>
<span class="go">Initialized algobattle project in 2D Knapsack</span>
</code></pre></div>
<p>We navigate into the newly created folder named <code>2D Knapsack</code>, which has the
following file structure:</p>
<div class="no-copy highlight"><pre><span></span><code>.
└─<span class="w"> </span>2D<span class="w"> </span>Knapsack
<span class="w">   </span>├─<span class="w"> </span>generator/
<span class="w">   </span>│<span class="w">  </span>├─<span class="w"> </span>.gitignore
<span class="w">   </span>│<span class="w">  </span>├─<span class="w"> </span>Dockerfile
<span class="w">   </span>│<span class="w">  </span>├─<span class="w"> </span>generator.py
<span class="w">   </span>│<span class="w">  </span>└─<span class="w"> </span>pyproject.toml
<span class="w">   </span>├─<span class="w"> </span>results/
<span class="w">   </span>├─<span class="w"> </span>solver/
<span class="w">   </span>│<span class="w">  </span>├─<span class="w"> </span>.gitignore
<span class="w">   </span>│<span class="w">  </span>├─<span class="w"> </span>Dockerfile
<span class="w">   </span>│<span class="w">  </span>├─<span class="w"> </span>pyproject.toml
<span class="w">   </span>│<span class="w">  </span>└─<span class="w"> </span>solver.py
<span class="w">   </span>├─<span class="w"> </span>.gitignore
<span class="w">   </span>├─<span class="w"> </span>problem.py
<span class="w">   </span>└─<span class="w"> </span>algobattle.toml
</code></pre></div>
<p>Before we implement anything, we should take the time to specify exactly how
an instance should look like. This means specifying the names of each key,
their function and which values are legal for each.</p>
<p>First of all, an instance should contain the dimensions of the knapsack that is
to be packed. For this, we introduce two keys <code>height</code> and <code>width</code>, and would
like each to be an integer of value at least one and at most of value <code>2**64</code>.</p>
<p>Secondly, we need to describe the items that are to be packed. Each item itself
has a height and a width, which should again each be of integer size at least
one. As an added restriction, we only want to allow items that are at all able
to fit into the knapsack, so as not to allow spamming a solver with items that
can never be part of a valid solution. To spare us some headache in the validation
step of the instance, we demand each item to fit into the knapsack without any 
rotation, as a sort of normalization of the instance.</p>
<p>Next, we need to specify the contents of a valid solution file. This is in
principle quite simple: We are interested in a list specifying which of 
the items of the instance
* should be placed in the knapsack
* at which position
* being rotated or not.</p>
<p>We will be lazy and define a dictionary <code>packing</code> that maps the index of items
to a three-tuple, as described.</p>
<h2 id="writing-a-mock-generator-and-solver">Writing a Mock Generator and Solver<a class="headerlink" href="#writing-a-mock-generator-and-solver" title="Permanent link">&para;</a></h2>
<p>Before we start writing any problem code, we write a mock generator and a mock
solver. This helps us do plausibility checks while writing the actual problem file
and is not required for the finished problem file.</p>
<p>We start with filling in the generator.</p>
<div class="highlight"><span class="filename">generator/generator.py</span><pre><span></span><code><span class="sd">&quot;&quot;&quot;Main module, will be run as the generator.&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>


<span class="n">max_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="s2">&quot;/input/max_size.txt&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">read_text</span><span class="p">())</span>

<span class="n">instance</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;height&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
    <span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="s1">&#39;items&#39;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="p">]</span>
<span class="p">}</span>

<span class="n">solution</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;packing&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="mi">0</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;unrotated&#39;</span><span class="p">],</span>
        <span class="mi">3</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;unrotated&#39;</span><span class="p">],</span>
        <span class="mi">4</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;rotated&#39;</span><span class="p">]</span>
    <span class="p">}</span>
<span class="p">}</span>


<span class="n">Path</span><span class="p">(</span><span class="s2">&quot;/output/instance.json&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">instance</span><span class="p">))</span>
<span class="n">Path</span><span class="p">(</span><span class="s2">&quot;/output/solution.json&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">solution</span><span class="p">))</span>
</code></pre></div>
<p>We made sure that the solution is not unique for the given instance
to make sure that the framework is able to compare two different solutions.
We next fill in the solver.</p>
<div class="highlight"><span class="filename">generator/solver.py</span><pre><span></span><code><span class="sd">&quot;&quot;&quot;Main module, will be run as the solver.&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>


<span class="n">instance</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="s2">&quot;/input/instance.json&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">read_text</span><span class="p">())</span>

<span class="n">solution</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;packing&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="mi">1</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;rotated&#39;</span><span class="p">]</span>
    <span class="p">}</span>
<span class="p">}</span>


<span class="n">Path</span><span class="p">(</span><span class="s2">&quot;/output/solution.json&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">solution</span><span class="p">))</span>
</code></pre></div>
<p>We are now able to immediately test any code that we write.</p>
<h2 id="handling-instances">Handling Instances<a class="headerlink" href="#handling-instances" title="Permanent link">&para;</a></h2>
<p>We already know that we expect three keys in any instance: A <code>height</code>,
a <code>width</code> and a list of <code>items</code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For brevity, the following code snippets do not include all necessary imports.
We provide the complete content of the <code>problem.py</code> at the end of this section.</p>
</div>
<p>Our first approach uses only very rough type annotations for our expected keys
and does a lot of the validation of the instance explicitly.</p>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;The 2D Knapsack problem module.&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">algobattle.problem</span> <span class="kn">import</span> <span class="n">Problem</span><span class="p">,</span> <span class="n">InstanceModel</span><span class="p">,</span> <span class="n">SolutionModel</span><span class="p">,</span> <span class="n">maximize</span>
<span class="kn">from</span> <span class="nn">algobattle.util</span> <span class="kn">import</span> <span class="n">Role</span><span class="p">,</span> <span class="n">ValidationError</span>
<span class="kn">from</span> <span class="nn">algobattle.types</span> <span class="kn">import</span> <span class="n">u64</span>


<span class="k">class</span> <span class="nc">Instance</span><span class="p">(</span><span class="n">InstanceModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Instances of 2D Knapsack.&quot;&quot;&quot;</span>

    <span class="n">height</span><span class="p">:</span> <span class="n">u64</span>
    <span class="n">width</span><span class="p">:</span> <span class="n">u64</span>

    <span class="n">items</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">u64</span><span class="p">,</span> <span class="n">u64</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">validate_instance</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">validate_instance</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;The knapsack is smaller than allowed!&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;An item of the instance is smaller than 1x1!&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">((</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="ow">or</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;An item of the instance cannot fit in the knapsack!&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">size</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">)</span>
</code></pre></div>
<p>We can clean this code up by tightening up the annotations a bit. </p>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;The 2D Knapsack problem module.&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">Field</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Annotated</span>

<span class="kn">from</span> <span class="nn">algobattle.problem</span> <span class="kn">import</span> <span class="n">Problem</span><span class="p">,</span> <span class="n">InstanceModel</span><span class="p">,</span> <span class="n">SolutionModel</span><span class="p">,</span> <span class="n">maximize</span>
<span class="kn">from</span> <span class="nn">algobattle.util</span> <span class="kn">import</span> <span class="n">Role</span><span class="p">,</span> <span class="n">ValidationError</span>
<span class="kn">from</span> <span class="nn">algobattle.types</span> <span class="kn">import</span> <span class="n">u64</span><span class="p">,</span> <span class="n">Interval</span><span class="p">,</span> <span class="n">InstanceRef</span>


<span class="n">item_height</span> <span class="o">=</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Interval</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">le</span><span class="o">=</span><span class="n">InstanceRef</span><span class="o">.</span><span class="n">height</span><span class="p">)]</span>
<span class="n">item_width</span> <span class="o">=</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Interval</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">le</span><span class="o">=</span><span class="n">InstanceRef</span><span class="o">.</span><span class="n">width</span><span class="p">)]</span>
<span class="n">point</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">item_height</span><span class="p">,</span> <span class="n">item_width</span><span class="p">]</span>


<span class="k">class</span> <span class="nc">Instance</span><span class="p">(</span><span class="n">InstanceModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Instances of 2D Knapsack.&quot;&quot;&quot;</span>

    <span class="n">height</span><span class="p">:</span> <span class="n">u64</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">width</span><span class="p">:</span> <span class="n">u64</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>


    <span class="n">items</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">point</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">size</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">)</span>
</code></pre></div>
<p>As you can see, we have moved all explicit checks from the <code>validate_instance</code>
method into the annotations. Do note that by using the <code>InstanceRef</code> import,
we are able to use the values of some keys to annotate other keys!</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you are not familiar with pydantics annotations, we recommend
using the <a href="https://docs.pydantic.dev/2.4/concepts/models/">pydantic documentation</a>
as a reference. As you have seen in the previous iteration of the code,
they are not essential, but very helpful to reduce code clutter and potential
mistakes.</p>
</div>
<p>This is already everything we need to implement for the instance. The <code>size</code>
method ensures that the number of items does not exceed the allowed limit given
by the instance size. We next turn to the solutions.</p>
<h2 id="handling-solutions">Handling Solutions<a class="headerlink" href="#handling-solutions" title="Permanent link">&para;</a></h2>
<p>The <code>packing</code> key is slightly more involved to construct. To
recapitulate, we would like this key to be a dictionary that maps
indices of items to a two-dimensional position and an indicator
whether they should be rotated. We use a similar approach as for the
<code>items</code> list. We additionally import the <code>Literal</code> class from the
<code>typing</code> module as well as the <code>SizeIndex</code> type alias from
<code>algobattle.types</code>.</p>
<div class="highlight"><pre><span></span><code><span class="n">position_height</span> <span class="o">=</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Interval</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">lt</span><span class="o">=</span><span class="n">InstanceRef</span><span class="o">.</span><span class="n">height</span><span class="p">)]</span>
<span class="n">position_width</span> <span class="o">=</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Interval</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">lt</span><span class="o">=</span><span class="n">InstanceRef</span><span class="o">.</span><span class="n">width</span><span class="p">)]</span>
<span class="n">rotation</span> <span class="o">=</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;unrotated&quot;</span><span class="p">,</span> <span class="s2">&quot;rotated&quot;</span><span class="p">]</span>


<span class="k">class</span> <span class="nc">Solution</span><span class="p">(</span><span class="n">SolutionModel</span><span class="p">[</span><span class="n">Instance</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Solutions of 2D Knapsack.&quot;&quot;&quot;</span>

    <span class="n">packing</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">SizeIndex</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">position_height</span><span class="p">,</span> <span class="n">position_width</span><span class="p">,</span> <span class="n">rotation</span><span class="p">]]</span>
</code></pre></div>
<p>This of course does not at all ensure that the given solution is valid, yet.
We did not yet check whether items overlap or extend beyond the boundaries
of the knapsack. Since these checks are arguably beyond the scope of simple
type checking, we implement these tests explicitly in the <code>validate_solution</code>
method. For convenience, we import the <code>itertools</code> library.</p>
<div class="highlight"><pre><span></span><code>    <span class="k">def</span> <span class="nf">validate_solution</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">:</span> <span class="n">Instance</span><span class="p">,</span> <span class="n">role</span><span class="p">:</span> <span class="n">Role</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">flattened_packing</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="p">(</span><span class="n">pos_height</span><span class="p">,</span> <span class="n">pos_width</span><span class="p">,</span> <span class="n">rotation</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">packing</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">item_height</span> <span class="o">=</span> <span class="n">instance</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">0</span> <span class="k">if</span> <span class="n">rotation</span> <span class="o">==</span> <span class="s2">&quot;unrotated&quot;</span> <span class="k">else</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">item_width</span> <span class="o">=</span> <span class="n">instance</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">1</span> <span class="k">if</span> <span class="n">rotation</span> <span class="o">==</span> <span class="s2">&quot;unrotated&quot;</span> <span class="k">else</span> <span class="mi">0</span><span class="p">]</span>

            <span class="n">height_endpoint</span> <span class="o">=</span> <span class="n">pos_height</span> <span class="o">+</span> <span class="n">item_height</span>
            <span class="n">width_endpoint</span> <span class="o">=</span> <span class="n">pos_width</span> <span class="o">+</span> <span class="n">item_width</span>
            <span class="n">flattened_packing</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">pos_height</span><span class="p">,</span> <span class="n">height_endpoint</span><span class="p">,</span> <span class="n">pos_width</span><span class="p">,</span> <span class="n">width_endpoint</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">height_endpoint</span> <span class="o">&gt;</span> <span class="n">instance</span><span class="o">.</span><span class="n">height</span> <span class="ow">or</span> <span class="n">width_endpoint</span> <span class="o">&gt;</span> <span class="n">instance</span><span class="o">.</span><span class="n">width</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span>
                <span class="s2">&quot;Item extends the knapsack boundaries.&quot;</span><span class="p">,</span>
                <span class="n">detail</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Item </span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2"> was placed at position (</span><span class="si">{</span><span class="n">pos_height</span><span class="p">,</span><span class="w"> </span><span class="n">pos_width</span><span class="si">}</span><span class="s2">), extending the knapsack boundaries.&quot;</span>
            <span class="p">)</span>

        <span class="k">for</span> <span class="n">item</span><span class="p">,</span> <span class="n">other_item</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span><span class="n">flattened_packing</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">other_item</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">and</span> <span class="n">item</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">other_item</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">other_item</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="ow">and</span> <span class="n">item</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">other_item</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span>
                    <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span>
                        <span class="s2">&quot;Two items overlap.&quot;</span><span class="p">,</span>
                        <span class="n">detail</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Items </span><span class="si">{</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">other_item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> overlap.&quot;</span>
                    <span class="p">)</span>
</code></pre></div>
<p>We are almost done writing the problem class. The next step is to tell
the framework what the quality of a solution is, i.e. which values it
should compare when given two solutions to determine which is the better one.</p>
<p>For this, we overwrite the <code>score</code> method. We have access to the solution
via the <code>self</code> argument, access to the instance via the <code>instance</code> argument
and can even decide to judge the certificate solution of the generator and
a solvers solution differently, via the <code>role</code> argument, e.g. to give the
solver some additional slack.</p>
<div class="highlight"><pre><span></span><code>    <span class="nd">@maximize</span>
    <span class="k">def</span> <span class="nf">score</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">:</span> <span class="n">Instance</span><span class="p">,</span> <span class="n">role</span><span class="p">:</span> <span class="n">Role</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">area</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">packing</span><span class="p">:</span>
            <span class="n">area</span> <span class="o">+=</span> <span class="n">instance</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">instance</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">area</span>
</code></pre></div>
<p>You can find the complete contents of the <code>problem.py</code> at the end of this
tutorial section.</p>
<h2 id="best-practice-writing-tests">Best Practice: Writing Tests<a class="headerlink" href="#best-practice-writing-tests" title="Permanent link">&para;</a></h2>
<p>Now that we have created a problem file, it is time to see if it
does what we want it to do. The most straightforward sanity check
is to run the mock generator and solver that we have written
previously.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you did not generate the problem folder as we did in this tutorial,
make sure that a team is entered in the <code>algobattle.toml</code> file that
utilizes the solver and generator that we wrote!</p>
</div>
<p>For this, we can use the <code>algobattle test</code> command. This command
builds the generators and solvers of the configured teams and
executes a single run of them at the minimum size that was configured
for the problem.</p>
<p>Running this command does however produce an issue:
<div class="highlight"><pre><span></span><code><span class="go">~ algobattle test</span>
<span class="go">Testing programs of team Rats</span>
<span class="go">Generator built successfully</span>
<span class="go">Generator didn&#39;t run successfully</span>
<span class="go">Solver built successfully</span>
<span class="go">Cannot test running the solver</span>
<span class="go">You can find detailed error messages at results/test-2024-01-01_12-35-10.json</span>
</code></pre></div></p>
<p>So what went wrong? Looking into the log files reveals the issue.</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;Rats&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;generator_run&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ValidationError&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;message&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Instance is too large.&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;detail&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Generated: 5, maximum: 1&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span><span class="w"> </span>
</code></pre></div>
<p>We wrote a generator and solver that run on an instance with five items,
but proclaimed in the <code>problem.py</code> that any instance with at least one 
item is valid:</p>
<div class="highlight"><pre><span></span><code><span class="n">Problem</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;2D Knapsack&quot;</span><span class="p">,</span>
    <span class="n">min_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">instance_cls</span><span class="o">=</span><span class="n">Instance</span><span class="p">,</span>
    <span class="n">solution_cls</span><span class="o">=</span><span class="n">Solution</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>
<p>Should we thus change our generator and solver? We do not have to,
as the <code>algobattle test</code> command allows us to run the test on a specific
instance size:</p>
<div class="highlight"><pre><span></span><code><span class="go">~ algobattle test --size 5</span>
<span class="go">Testing programs of team Rats</span>
<span class="go">Generator built successfully</span>
<span class="go">Generator ran successfully</span>
<span class="go">Solver built successfully</span>
<span class="go">Solver ran successfully</span>
</code></pre></div>
<p>This tells us that the combination of our problem description
with a small, hand-crafted instance behaves as expected. It is at this
stage where most of the errors in the code come to light. You
can use the log files written into the <code>results</code> folder to assist
you in debugging your code. You may find at this stage that it does
pay off to write detailed <code>ValidationError</code> exception messages.</p>
<p>Just because our single, hand-crafted test ran through, this does not
mean that our code is without any conceptual errors. Especially when
giving your problem file to other people, who will likely spend much more
time dissecting your code and descriptions to learn how to write their
own programs, many unexpected issues with your code may come to light.</p>
<p>To mitigate some of the reports of illegal inputs that are nevertheless
accepted by your code, legal inputs that are rejected by your code, or worst
-- code that crashes your validation code -- it is a good idea to write a few
unittests.</p>
<p>We do not want to dive into too much detail on how you could test your
code, how much coverage may be desirable and related topics, as this
goes well beyond the scope of this tutorial. Testing code is a topic
about which volumes have been written by authors who are much more
knowledgeable about the topic as we could claim to be.</p>
<p>Thus, we only talk about how to best interface the problem that we
have designed, so that you can then use this knowledge to write
your own tests. We use the <code>unittest</code> module from the standard library
for this part of the tutorial.</p>
<p>We create a file <code>tests.py</code> in the <code>2D Knapsack</code> folder, with generic
scaffolding.</p>
<div class="highlight"><span class="filename">tests.py</span><pre><span></span><code><span class="sd">&quot;&quot;&quot;Tests for the 2D Knapsack problem.&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">unittest</span>

<span class="kn">from</span> <span class="nn">algobattle.util</span> <span class="kn">import</span> <span class="n">Role</span>

<span class="kn">from</span> <span class="nn">problem</span> <span class="kn">import</span> <span class="n">Instance</span><span class="p">,</span> <span class="n">Solution</span><span class="p">,</span> <span class="n">ValidationError</span>


<span class="k">class</span> <span class="nc">Tests</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Tests for the 2D Knapsack problem solution class.&quot;&quot;&quot;</span>

    <span class="o">...</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</code></pre></div>
<p>You can then access all additional helper methods that you may have
added to the <code>Instance</code> and <code>Solution</code> classes as you would normally do.</p>
<p>If you would like to test the validation methods, i.e. <code>validate_instance</code>
and <code>validate_solution</code>, you could do so as follows.</p>
<p>Assume, just for the sake of being able to give an example, that we would have
added a <code>validate_instance</code> method to the <code>Instance</code> class with the following,
rather nonsensical content:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># This method is just for demonstration purposes.</span>
<span class="k">def</span> <span class="nf">validate_instance</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">validate_instance</span><span class="p">()</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;The knapsack is not of height 1!?&quot;</span><span class="p">)</span>
</code></pre></div>
<p>This rather silly method raises a validation error whenever the
height of the knapsacks is unequal to one.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Sample test for the validate_instance method</span>
<span class="k">def</span> <span class="nf">test_knapsack_height_not_silly</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">ValidationError</span><span class="p">):</span>
        <span class="n">faulty_instance</span> <span class="o">=</span> <span class="n">Instance</span><span class="o">.</span><span class="n">model_validate</span><span class="p">({</span><span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;items&quot;</span><span class="p">:</span> <span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]})</span>
        <span class="n">faulty_instance</span><span class="o">.</span><span class="n">validate_instance</span><span class="p">()</span>

<span class="c1"># Sample test for the validate_solution method</span>
<span class="k">def</span> <span class="nf">test_item_overlap</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">instance</span> <span class="o">=</span> <span class="n">Instance</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">items</span><span class="o">=</span><span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)])</span>
    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">ValidationError</span><span class="p">):</span>
        <span class="n">faulty_solution</span> <span class="o">=</span> <span class="n">Solution</span><span class="o">.</span><span class="n">model_validate</span><span class="p">({</span><span class="s2">&quot;packing&quot;</span><span class="p">:</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;unrotated&quot;</span><span class="p">),</span> <span class="mi">1</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;unrotated&quot;</span><span class="p">)}})</span>
        <span class="n">faulty_solution</span><span class="o">.</span><span class="n">validate_solution</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">Role</span><span class="o">.</span><span class="n">generator</span><span class="p">)</span>
</code></pre></div>
<p>You can test the <code>size</code> function of the <code>Instance</code> class
and the <code>score</code> function of the <code>Solution</code> class as you would test any other
method.</p>
<p>If you use the <code>unittest</code> module, you can then run these tests by
executing <code>python -m unittest</code> in the <code>2D Knapsack</code> folder.</p>
<h2 id="writing-a-description">Writing a Description<a class="headerlink" href="#writing-a-description" title="Permanent link">&para;</a></h2>
<p>We are done writing code for the problem. Now, it is a good idea
to write a description file that tells the users that should work
on the problem what it is about. This includes explaining the general
idea and, more importantly, how the expected I/O is defined.</p>
<p>We recommend creating a file in the <code>2D Knapsack</code> folder named <code>description.md</code>,
as this file name is automatically picked up by the packaging step 
that we will handle in the next step.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you use the <code>algobattle-web</code> framework, the contents of this file
will be displayed to your users when they click on the respective
problem tab.</p>
</div>
<h2 id="packaging-everything-together">Packaging Everything Together<a class="headerlink" href="#packaging-everything-together" title="Permanent link">&para;</a></h2>
<p>Now that our code is tested and documented, we are ready to hand it out!
For this, we can again use the <code>algobattle</code> cli, which wraps up the
<code>problem.py</code>, the <code>algobattle.toml</code> and the <code>description.md</code> into a file
that others can work on.</p>
<div class="highlight"><pre><span></span><code><span class="go">~ algobattle package problem</span>
<span class="go">Packaged Algobattle project into /path/to/working/dir/2D Knapsack/2d_knapsack.algo</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code>algobattle.toml</code> gets truncated during the packaging step. Only the <code>[match]</code>
entries remain.</p>
</div>
<h2 id="the-completed-problempy-file">The Completed problem.py File<a class="headerlink" href="#the-completed-problempy-file" title="Permanent link">&para;</a></h2>
<p>This is the final content of the <code>problem.py</code> that we have created.</p>
<div class="highlight"><span class="filename">problem.py</span><pre><span></span><code><span class="sd">&quot;&quot;&quot;The 2D Knapsack problem module.&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">Field</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Annotated</span><span class="p">,</span> <span class="n">Literal</span>

<span class="kn">from</span> <span class="nn">algobattle.problem</span> <span class="kn">import</span> <span class="n">Problem</span><span class="p">,</span> <span class="n">InstanceModel</span><span class="p">,</span> <span class="n">SolutionModel</span><span class="p">,</span> <span class="n">maximize</span>
<span class="kn">from</span> <span class="nn">algobattle.util</span> <span class="kn">import</span> <span class="n">Role</span><span class="p">,</span> <span class="n">ValidationError</span>
<span class="kn">from</span> <span class="nn">algobattle.types</span> <span class="kn">import</span> <span class="n">u64</span><span class="p">,</span> <span class="n">Interval</span><span class="p">,</span> <span class="n">InstanceRef</span><span class="p">,</span> <span class="n">SizeIndex</span>


<span class="n">item_height</span> <span class="o">=</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Interval</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">le</span><span class="o">=</span><span class="n">InstanceRef</span><span class="o">.</span><span class="n">height</span><span class="p">)]</span>
<span class="n">item_width</span> <span class="o">=</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Interval</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">le</span><span class="o">=</span><span class="n">InstanceRef</span><span class="o">.</span><span class="n">width</span><span class="p">)]</span>
<span class="n">point</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">item_height</span><span class="p">,</span> <span class="n">item_width</span><span class="p">]</span>


<span class="k">class</span> <span class="nc">Instance</span><span class="p">(</span><span class="n">InstanceModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Instances of 2D Knapsack.&quot;&quot;&quot;</span>

    <span class="n">height</span><span class="p">:</span> <span class="n">u64</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">width</span><span class="p">:</span> <span class="n">u64</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">items</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">point</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">size</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">)</span>


<span class="n">position_height</span> <span class="o">=</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Interval</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">lt</span><span class="o">=</span><span class="n">InstanceRef</span><span class="o">.</span><span class="n">height</span><span class="p">)]</span>
<span class="n">position_width</span> <span class="o">=</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Interval</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">lt</span><span class="o">=</span><span class="n">InstanceRef</span><span class="o">.</span><span class="n">width</span><span class="p">)]</span>
<span class="n">rotation</span> <span class="o">=</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;unrotated&quot;</span><span class="p">,</span> <span class="s2">&quot;rotated&quot;</span><span class="p">]</span>


<span class="k">class</span> <span class="nc">Solution</span><span class="p">(</span><span class="n">SolutionModel</span><span class="p">[</span><span class="n">Instance</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Solutions of 2D Knapsack.&quot;&quot;&quot;</span>

    <span class="n">packing</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">SizeIndex</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">position_height</span><span class="p">,</span> <span class="n">position_width</span><span class="p">,</span> <span class="n">rotation</span><span class="p">]]</span>

    <span class="k">def</span> <span class="nf">validate_solution</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">:</span> <span class="n">Instance</span><span class="p">,</span> <span class="n">role</span><span class="p">:</span> <span class="n">Role</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">flattened_packing</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="p">(</span><span class="n">pos_height</span><span class="p">,</span> <span class="n">pos_width</span><span class="p">,</span> <span class="n">rotation</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">packing</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">item_height</span> <span class="o">=</span> <span class="n">instance</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">0</span> <span class="k">if</span> <span class="n">rotation</span> <span class="o">==</span> <span class="s2">&quot;unrotated&quot;</span> <span class="k">else</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">item_width</span> <span class="o">=</span> <span class="n">instance</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">1</span> <span class="k">if</span> <span class="n">rotation</span> <span class="o">==</span> <span class="s2">&quot;unrotated&quot;</span> <span class="k">else</span> <span class="mi">0</span><span class="p">]</span>

            <span class="n">height_endpoint</span> <span class="o">=</span> <span class="n">pos_height</span> <span class="o">+</span> <span class="n">item_height</span>
            <span class="n">width_endpoint</span> <span class="o">=</span> <span class="n">pos_width</span> <span class="o">+</span> <span class="n">item_width</span>
            <span class="n">flattened_packing</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">pos_height</span><span class="p">,</span> <span class="n">height_endpoint</span><span class="p">,</span> <span class="n">pos_width</span><span class="p">,</span> <span class="n">width_endpoint</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">height_endpoint</span> <span class="o">&gt;</span> <span class="n">instance</span><span class="o">.</span><span class="n">height</span> <span class="ow">or</span> <span class="n">width_endpoint</span> <span class="o">&gt;</span> <span class="n">instance</span><span class="o">.</span><span class="n">width</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span>
                <span class="s2">&quot;Item extends the knapsack boundaries.&quot;</span><span class="p">,</span>
                <span class="n">detail</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Item </span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2"> was placed at position (</span><span class="si">{</span><span class="n">pos_height</span><span class="p">,</span><span class="w"> </span><span class="n">pos_width</span><span class="si">}</span><span class="s2">), extending the knapsack boundaries.&quot;</span>
            <span class="p">)</span>

        <span class="k">for</span> <span class="n">item</span><span class="p">,</span> <span class="n">other_item</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span><span class="n">flattened_packing</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">other_item</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">and</span> <span class="n">item</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">other_item</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">other_item</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="ow">and</span> <span class="n">item</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">other_item</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span>
                    <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span>
                        <span class="s2">&quot;Two items overlap.&quot;</span><span class="p">,</span>
                        <span class="n">detail</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Items </span><span class="si">{</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">other_item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> overlap.&quot;</span>
                    <span class="p">)</span>

    <span class="nd">@maximize</span>
    <span class="k">def</span> <span class="nf">score</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">:</span> <span class="n">Instance</span><span class="p">,</span> <span class="n">role</span><span class="p">:</span> <span class="n">Role</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">area</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">packing</span><span class="p">:</span>
            <span class="n">area</span> <span class="o">+=</span> <span class="n">instance</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">instance</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">area</span>


<span class="n">Problem</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;2D Knapsack&quot;</span><span class="p">,</span>
    <span class="n">min_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">instance_cls</span><span class="o">=</span><span class="n">Instance</span><span class="p">,</span>
    <span class="n">solution_cls</span><span class="o">=</span><span class="n">Solution</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.instant", "navigation.tabs", "navigation.sections", "navigation.indexes", "navigation.top", "toc.follow", "search.suggest", "search.highlight", "search.share", "content.tabs.link", "content.code.annotate", "content.code.copy"], "search": "../../../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.d7c377c4.min.js"></script>
      
        <script src="../../../js/termynal.js"></script>
      
        <script src="../../../js/custom.js"></script>
      
    
  </body>
</html>